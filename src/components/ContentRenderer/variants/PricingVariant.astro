---
// src/components/ContentRenderer/variants/PricingVariant.astro
/**
 * Pricing Variant - Pricing cards in 3-column grid
 * Features: Price, features by category, CTA button, featured highlight
 */

import type { BaseVariantProps } from "../ContentRenderer.types";
import Button from "@/components/Button/Button";
import SectionHeader from "@/components/SectionHeader";
import Icon from "@/components/Icon";

interface PricingFeature {
  category: string;
  items: string[];
}

interface PricingItem {
  id: string;
  title: string;
  description?: string;
  icon?: string;
  monthlyPrice: string;
  downPayment?: string;
  priceNote?: string;
  bestFor?: string;
  featured?: boolean;
  includes?: string;
  features?: PricingFeature[];
  cta?: {
    text: string;
    link: string;
  };
}

interface Props extends BaseVariantProps {
  columns?: 1 | 2 | 3;
  items?: PricingItem[];
}

const {
  items = [],
  title,
  heading,
  description,
  className = "",
  columns = 3,
  id,
} = Astro.props as Props;

const columnClasses = {
  1: "grid-cols-1",
  2: "grid-cols-1 md:grid-cols-2",
  3: "grid-cols-1 md:grid-cols-2 lg:grid-cols-3",
};

// Find the tier names for "includes" references
const tierNames = new Map(items.map(item => [item.id, item.title]));
---

<section id={id} class={`bg-white py-20 ${className}`}>
  <div class="container mx-auto px-4 max-w-7xl">
    <!-- Section Header -->
    {(title || heading || description) && (
      <div class="mb-16">
        <SectionHeader
          subtitle={title}
          title={heading || ""}
          description={description}
          align="center"
          titleTag="h2"
          containerClass="space-y-4 mx-auto max-w-4xl"
        />
      </div>
    )}

    <!-- Pricing Cards -->
    {items.length > 0 && (
      <ul class={`grid ${columnClasses[columns]} gap-8 list-none items-stretch`}>
        {items.map((item) => (
          <li class="flex">
            <div
              class={`flex flex-col w-full rounded-2xl p-8 ${
                item.featured
                  ? 'bg-black text-white shadow-2xl relative'
                  : 'bg-gray-50 text-gray-900'
              }`}
            >
              {/* Featured Badge */}
              {item.featured && (
                <div class="absolute -top-4 left-1/2 -translate-x-1/2">
                  <span class="bg-white text-gray-900 text-sm font-bold px-4 py-1 rounded-full shadow-md">
                    Most Popular
                  </span>
                </div>
              )}

              {/* Tier Icon */}
              {item.icon && (
                <div class="flex justify-center mb-4">
                  <Icon
                    icon={item.icon}
                    size="xl"
                    className={item.featured ? "text-yellow-400" : "text-gray-700"}
                  />
                </div>
              )}

              {/* Header */}
              <div class="text-center mb-6">
                <h3 class={`text-2xl font-bold mb-2 ${item.featured ? 'text-white' : 'text-gray-900'}`}>
                  {item.title}
                </h3>
                {item.description && (
                  <p class={`text-sm ${item.featured ? 'text-gray-400' : 'text-gray-600'}`}>
                    {item.description}
                  </p>
                )}
              </div>

              {/* Price */}
              <div class="text-center mb-6">
                <div class={`text-4xl font-bold ${item.featured ? 'text-white' : 'text-gray-900'}`}>
                  {item.monthlyPrice}<span class="text-lg font-normal"> /month</span>
                </div>
                {item.downPayment && (
                  <p class={`text-sm mt-1 ${item.featured ? 'text-gray-400' : 'text-gray-500'}`}>
                    {item.downPayment}
                  </p>
                )}
              </div>

              {/* Best For */}
              {item.bestFor && (
                <div class={`text-sm mb-6 p-3 rounded-lg ${
                  item.featured ? 'bg-gray-800 text-gray-300' : 'bg-gray-100 text-gray-700'
                }`}>
                  <span class="font-semibold">Best for:</span> {item.bestFor}
                </div>
              )}

              {/* CTA Button - Top */}
              {item.cta && (
                <div class="mb-6">
                  <Button
                    href={item.cta.link}
                    variant={item.featured ? "secondary" : "primary"}
                    size="lg"
                    className="w-full justify-center"
                  >
                    {item.cta.text}
                  </Button>
                </div>
              )}

              {/* Includes Reference */}
              {item.includes && tierNames.get(item.includes) && (
                <div class={`text-sm mb-4 font-medium ${
                  item.featured ? 'text-gray-400' : 'text-gray-600'
                }`}>
                  <Icon icon="lu:circle-check" className="w-4 h-4 inline mr-1" />
                  Everything in {tierNames.get(item.includes)}, plus:
                </div>
              )}

              {/* Features by Category */}
              <div class="flex-grow space-y-6 mb-8">
                {item.features?.map((featureGroup) => (
                  <div>
                    <h4 class={`text-sm font-semibold mb-3 ${
                      item.featured ? 'text-white' : 'text-gray-900'
                    }`}>
                      {featureGroup.category}
                    </h4>
                    <ul class="space-y-2">
                      {featureGroup.items.map((feature) => (
                        <li class="flex items-start gap-2 text-sm">
                          <Icon
                            icon="lu:check"
                            className={`w-4 h-4 mt-0.5 flex-shrink-0 ${
                              item.featured ? 'text-green-400' : 'text-green-600'
                            }`}
                          />
                          <span class={item.featured ? 'text-gray-300' : 'text-gray-700'}>
                            {feature}
                          </span>
                        </li>
                      ))}
                    </ul>
                  </div>
                ))}
              </div>

              {/* CTA Button */}
              {item.cta && (
                <div class="mt-auto">
                  <Button
                    href={item.cta.link}
                    variant={item.featured ? "secondary" : "primary"}
                    size="lg"
                    className="w-full justify-center"
                  >
                    {item.cta.text}
                  </Button>
                </div>
              )}
            </div>
          </li>
        ))}
      </ul>
    )}
  </div>
</section>
