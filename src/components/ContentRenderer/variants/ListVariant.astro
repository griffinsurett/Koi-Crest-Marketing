---
// src/components/ContentRenderer/variants/ListVariant.astro
/**
 * List Variant - Flexible list layout
 * 
 * Features: 
 * - Horizontal cards (default): Side-by-side image/content, full width
 * - Vertical links (orientation="vertical"): Simple stacked links for footer/sidebar
 */

import type { BaseVariantProps } from "../ContentRenderer.types";
import ListCard from '@/components/LoopComponents/ListCard.astro';
import { shouldShowCollectionCTA } from "../utils/helpers";
import { formatPhoneNumber } from '@/utils/string';
import Button from "@/components/Button/Button";

interface Props extends BaseVariantProps {
  orientation?: 'horizontal' | 'vertical';
}

const { 
  items = [],
  title,
  description,
  className = '',
  collectionUrl,
  collectionTitle,
  id,
  orientation = 'horizontal',
} = Astro.props as Props;

const viewAllText = `See Complete ${collectionTitle || 'List'}`;
const isVertical = orientation === 'vertical';

const getDisplayTitle = (item: any) => {
  const rawTitle = item?.title ?? item?.data?.title;
  const id = item?.id ?? item?.slug ?? item?.data?.id ?? item?.data?.slug;
  const linkPrefix = item?.linkPrefix ?? item?.data?.linkPrefix;
  // Format only the contact phone entry (id = phone or tel: link).
  if (typeof rawTitle === 'string' && (id === 'phone' || (typeof linkPrefix === 'string' && linkPrefix.startsWith('tel')))) {
    return formatPhoneNumber(rawTitle);
  }
  return rawTitle;
};

const getHref = (item: any) => {
  const href = item?.url ?? item?.data?.url;
  if (href) return href;
  const linkPrefix = item?.linkPrefix ?? item?.data?.linkPrefix;
  const title = item?.title ?? item?.data?.title;
  return linkPrefix && title ? `${linkPrefix}${title}` : undefined;
};
---

<section id={id} class={`${className}`}>
  {title && (
    <div class="mb-0">
      {title && <h3 class="text-base uppercase font-bold mb-2">{title}</h3>}
    </div>
  )}
  
  {items.length > 0 && (
    isVertical ? (
      <ul class="space-y-2 list-none">
        {items.map((item) => (
          <li>
            <Button
              variant="nounderlink" 
              href={getHref(item) || '#'} 
              className="text-gray-600 hover:text-gray-900 transition text-sm block py-1"
              target={item.openInNewTab ? '_blank' : undefined}
              rel={item.openInNewTab ? 'noopener noreferrer' : undefined}
            >
              {getDisplayTitle(item)}
            </Button>
          </li>
        ))}
      </ul>
    ) : (
      <ul class="flex flex-col gap-8 list-none">
        {items.map((item) => (
          <li>
            <ListCard {...item} title={getDisplayTitle(item)} />
          </li>
        ))}
      </ul>
    )
  )}
</section>
