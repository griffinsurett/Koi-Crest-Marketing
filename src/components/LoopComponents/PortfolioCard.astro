---
import { Image } from 'astro:assets';
import {
  normalizeCollectionImage,
  type CollectionImage,
  type NormalizedImage,
} from '@/utils/images';

// src/components/LoopComponents/PortfolioCard.astro
/**
 * Portfolio Card Component
 * 
 * Displays project cards with:
 * - Category badge (top-left, black pill)
 * - Project image (600x400)
 * - Project title
 * - Service tags (gray pills)
 * - Description with left border accent
 * 
 * Used in PortfolioVariant for project showcases
 */

export interface Props {
  title: string;              // Project title
  industry?: string;          // Industry/category (Gaming, Real Estate, etc.)
  tags?: string[];            // Service tags (SEO, Social Media, etc.)
  description?: string;       // Project description/results
  result?: string;            // Project results text
  image?: CollectionImage;    // Optional override image
  featuredImage?: CollectionImage;        // Optional featured image from collection data
  url?: string;              // Link to project page
}

const { 
  title, 
  industry,
  tags = [],
  description,
  result,
  image,
  featuredImage,
  url
} = Astro.props;

// Resolve image source from explicit image prop or featuredImage fallback
const rawImage = (image || featuredImage) as CollectionImage | undefined;
const displayImage: NormalizedImage | undefined = normalizeCollectionImage(
  rawImage,
  title
);
---

<article class="bg-gray-100 rounded-lg overflow-hidden">
  <!-- Image with Category Badge -->
  <div class="relative">
    {displayImage ? (
      displayImage.type === "asset" ? (
        <Image 
          src={displayImage.src} 
          alt={displayImage.alt}
          class="w-full h-64 object-cover"
          width={500}
          height={300}
          loading={"lazy"}
          formats={["avif", "webp", "jpeg"]}
        />
      ) : (
        <img 
          src={displayImage.src}
          alt={displayImage.alt}
          class="w-full h-64 object-cover"
          loading="lazy"
        />
      )
    ) : (
      <div class="w-full h-64 bg-gray-200 flex items-center justify-center">
        <span class="text-4xl text-gray-400 font-bold">600 Ã— 400</span>
      </div>
    )}
    
    {/* Category Badge - Always on top left, regardless of image */}
    {industry && (
      <div class="absolute top-4 left-4 z-10 shadow-2xl">
        <span class="inline-block bg-black text-white text-sm font-medium px-4 py-2 rounded-md">
          {industry}
        </span>
      </div>
    )}
  </div>

  <!-- Card Content -->
  <div class="p-6 space-y-4">
    <!-- Project Title -->
    {url ? (
      <a href={url} class="block">
        <h3 class="text-2xl font-bold text-gray-900 hover:text-gray-700 transition-colors">
          {title}
        </h3>
      </a>
    ) : (
      <h3 class="text-2xl font-bold text-gray-900">
        {title}
      </h3>
    )}

    <!-- Service Tags -->
    {tags.length > 0 && (
      <div class="flex flex-wrap gap-2">
        {tags.map((tag) => (
          <span class="inline-block bg-gray-200 text-gray-700 text-sm px-3 py-1 rounded-full">
            {tag}
          </span>
        ))}
      </div>
    )}

    <!-- Description with Left Border Accent -->
    {(result || description) && (
      <div class="border-l-4 border-gray-900 pl-4">
        <p class="text-gray-600 italic">
          {result || description}
        </p>
      </div>
    )}
  </div>
</article>
