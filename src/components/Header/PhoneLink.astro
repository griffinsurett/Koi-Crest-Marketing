---
// src/components/Header/PhoneLink.astro
/**
 * Reusable phone CTA link for header/footer areas.
 * Keeps markup in one place so layouts stay lean.
 */
import Icon from "@/components/Icon";
import { item } from "@/utils/query/snippets";
import { formatPhoneNumber } from "@/utils/string";

const phoneEntry = await item("contact-us", "phone");
if (!phoneEntry?.data?.title) {
  throw new Error("contact-us entry 'phone' requires a title.");
}

const { title, linkPrefix, icon, label } = phoneEntry.data;

if (!linkPrefix) {
  throw new Error("contact-us entry 'phone' requires a linkPrefix.");
}

if (!icon) {
  throw new Error("contact-us entry 'phone' requires an icon.");
}

const displayNumber = formatPhoneNumber(title);
const ariaLabel = label ? `Call ${label}` : `Call us at ${displayNumber}`;
const telHref = `${linkPrefix}${title.replace(/[^\d+]/g, "")}`;
---

<a
  href={telHref}
  aria-label={ariaLabel}
  class="flex items-center lg:space-x-2 transition font-medium"
>
  <Icon icon={icon} size="lg" className="transform text-MainDark" />
  <span class="text-lg hidden lg:block">{displayNumber}</span>
</a>
