---
// src/pages/index.astro
import BaseLayout from "@/layouts/BaseLayout.astro";
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import { siteData } from "@/content/siteData";
import {
  query,
  sortByDate,
  sortByOrder,
  whereArrayContains,
} from "@/utils/query";
import FrontPageHero from "@/layouts/FrontPageHero.astro";
import AboutSection from "@/layouts/AboutSection.astro";
import CaseStudySection from "@/layouts/CaseStudySection.astro";
import CTASection from "@/layouts/CTASection.astro";
import { byTag, roots } from "@/utils/query/snippets";
import homeAboutImage from "@/assets/template-1.png";
import koiRoofingImage from "@/assets/koirandssite.png";
import koiJohns from "@/assets/koijohns1.jpg";
import koiTeam from "@/assets/koi_team2.JPG";
---

<BaseLayout
  title={`${siteData.title} - home`}
  description={siteData.description}
>
  <main class="flex-1">
    <!-- Hero with Portfolio Showcase -->
    <FrontPageHero
      title="Were Here To Get You Customers!"
      description={siteData.description}
      subtitle={siteData.tagline}
    />

        <!-- Services - auto-populates from services meta -->
    <ContentRenderer
      query={roots("services")}
      variant="ServicesVariant"
      columns={3}
      gap="lg"
      
    />

    <AboutSection
      subtitle="About Us"
      title="Veteran-Owned. Contractor-Operated. Nationwide."
      description={`Founded by a veteran who owns Koi Roofing and Solar, we built this marketing system to grow
    our own contracting business. Now we're helping home service pros across the entire United States
    dominate their local markets with the same proven playbook.`}
      learnMoreUrl="/about-us"
      image={{ src: homeAboutImage, alt: "Veteran-owned contractor marketing" }}
    >
      <div class="flex flex-col lg:flex-row gap-16 items-start">
        <!-- Left Column - Our Promise -->
        <div class="space-y-6 lg:w-3/5">
          <h3 class="h3 font-bold">Free Website With Annual Plans</h3>

          <p class="text-main text-gray-300 leading-relaxed">
            Sign up for an annual plan and get a free website — built, hosted,
            and maintained by us. These aren't template sites. They're
            lightning-fast, conversion-optimized machines that load faster than
            your competition. We serve contractors nationwide, from coast to
            coast.
          </p>
        </div>

        <!-- Right Column - Benefits (from content collection) -->
        <ContentRenderer query={query("benefits")} variant="BenefitsVariant" />
      </div>
    </AboutSection>

    <!-- Case Study: Koi Roofing and Solar -->
    <CaseStudySection
      subtitle="Where We Learned"
      title="Built From Real Results With Koi Roofing & Solar"
      description="This isn't theory — it's battle-tested. We built this marketing system to grow Koi Roofing and Solar from the ground up. The same strategies that filled their pipeline with qualified leads are now available to contractors like you."
      images={[
        { src: koiRoofingImage, alt: "Koi Roofing and Solar website" },
        { src: koiJohns, alt: "Koi Roofing and Solar team member" },
        { src: koiTeam, alt: "Koi Roofing and Solar team" },
      ]}
      stats={[
        { value: "300%", label: "Increase in Leads" },
        { value: "400%", label: "More Search Visibility" },
        { value: "2.5x", label: "Revenue Growth" },
        { value: "50+", label: "5-Star Reviews" },
      ]}
      ctaText="Get These Results For Your Business"
      ctaUrl="/contact"
    />

    <ContentRenderer query={query("reasons")} variant="WhyChooseUsVariant" />

    <!-- Industries Section -->
    <ContentRenderer
      query={query("industries").orderBy(sortByOrder())}
      variant="IndustriesGridVariant"
      heading="Built For Home Service Contractors"
      description="From roofers to plumbers, HVAC techs to landscapers — we specialize in marketing for the trades. Our strategies are tailored to how homeowners actually search for and hire contractors in your specific industry."
    />

    <!-- Process Steps Section -->
    <ContentRenderer
      query={query("steps").orderBy(sortByOrder())}
      variant="StepsVariant"
      title="Our Process"
      heading="How We Get You More Customers"
    />

    <!-- Filtered query - still gets meta from authors -->
    <!-- <ContentRenderer
      query={query("authors").where(whereArrayContains("tags", "featured"))}
      variant="GridVariant"
      columns={3}
      gap="lg"
    /> -->

    <!-- projects and testimonials must remain but stay commented out due to the lack of these and will be reenabled at a later point
    <ContentRenderer
      query={query("projects")
        .orderBy(sortByDate("publishDate", "desc"))}
      variant="PortfolioBoxVariant"
    />
    <ContentRenderer
      query={query("testimonials")}
      variant="TestimonialsVariant"
    />
    -->

    <!-- FAQ ContentRenderer -->
    <ContentRenderer
      query={query("faq").orderBy(sortByOrder())}
      variant="AccordionVariant"
      allowMultiple={false}
    />

    <!-- Contact ContentRenderer -->
    <CTASection>
      <!-- Multi-collection query - requires manual title/description -->
      <ContentRenderer
        query={query(["blog", "projects"]).orderBy(sortByDate()).limit(10)}
        variant="ListVariant"
        title="Recent Updates"
        description="Latest from our blog and portfolio"
      />
    </CTASection>
  </main>
</BaseLayout>
