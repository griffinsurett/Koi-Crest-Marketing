---
// src/pages/index.astro
import BaseLayout from "@/layouts/BaseLayout.astro";
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import { siteData } from "@/content/siteData";
import {
  query,
  sortByDate,
  sortByOrder,
  whereArrayContains,
} from "@/utils/query";
import FrontPageHero from "@/layouts/FrontPageHero.astro";
import AboutSection from "@/layouts/AboutSection.astro";
import CTASection from "@/layouts/CTASection.astro";
import { byTag, roots } from "@/utils/query/snippets";
import homeAboutImage from "@/assets/template-1.png";
---

<BaseLayout
  title={`${siteData.title} - home`}
  description={siteData.description}
>
  <main class="flex-1">
    <!-- Hero with Portfolio Showcase -->
    <FrontPageHero
      title="Were Here To Get You Customers!"
      description={siteData.description}
      subtitle={siteData.tagline}
    />

        <!-- Services - auto-populates from services meta -->
    <ContentRenderer
      query={roots("services")}
      variant="ServicesVariant"
      columns={3}
      gap="lg"
      
    />

    <AboutSection
      subtitle="About Us"
      title="Veteran-Owned. Contractor-Operated. Nationwide."
      description={`Founded by a veteran who owns Koi Roofing and Solar, we built this marketing system to grow
    our own contracting business. Now we're helping home service pros across the entire United States
    dominate their local markets with the same proven playbook.`}
      learnMoreUrl="/about-us"
      image={{ src: homeAboutImage, alt: "Veteran-owned contractor marketing" }}
    >
      <div class="flex flex-col lg:flex-row gap-16 items-start">
        <!-- Left Column - Our Promise -->
        <div class="space-y-6 lg:w-3/5">
          <h3 class="h3 font-bold">Free Website With Annual Plans</h3>

          <p class="text-main text-gray-300 leading-relaxed">
            Sign up for an annual plan and get a free website â€” built, hosted,
            and maintained by us. These aren't template sites. They're
            lightning-fast, conversion-optimized machines that load faster than
            your competition. We serve contractors nationwide, from coast to
            coast.
          </p>
        </div>

        <!-- Right Column - Benefits (from content collection) -->
        <ContentRenderer query={query("benefits")} variant="BenefitsVariant" />
      </div>
    </AboutSection>

    <ContentRenderer query={query("reasons")} variant="WhyChooseUsVariant" />

    <!-- Filtered query - still gets meta from authors -->
    <!-- <ContentRenderer
      query={query("authors").where(whereArrayContains("tags", "featured"))}
      variant="GridVariant"
      columns={3}
      gap="lg"
    /> -->

    <!-- projects and testimonials must remain but stay commented out due to the lack of these and will be reenabled at a later point
    <ContentRenderer
      query={query("projects")
        .orderBy(sortByDate("publishDate", "desc"))}
      variant="PortfolioBoxVariant"
    />
    <ContentRenderer
      query={query("testimonials")}
      variant="TestimonialsVariant"
    />
    -->

    <!-- FAQ ContentRenderer -->
    <ContentRenderer
      query={query("faq").orderBy(sortByOrder())}
      variant="AccordionVariant"
      allowMultiple={false}
    />

    <!-- Contact ContentRenderer -->
    <CTASection>
      <!-- Multi-collection query - requires manual title/description -->
      <ContentRenderer
        query={query(["blog", "projects"]).orderBy(sortByDate()).limit(10)}
        variant="ListVariant"
        title="Recent Updates"
        description="Latest from our blog and portfolio"
      />
    </CTASection>
  </main>
</BaseLayout>
