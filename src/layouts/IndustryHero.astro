---
// src/layouts/IndustryHero.astro
/**
 * Industry Hero - Split hero for industry pages
 * Features: Title (small) above heading (large), left-aligned text, image on right
 * Directs users to view pricing options
 * Optimized for LCP with responsive WebP images
 */

import { getImage } from "astro:assets";
import SectionHeader from "@/components/SectionHeader";
import Button from "@/components/Button/Button";
import HeroStats from "@/components/HeroStats.astro";
import placeholderImage from "@/assets/template-1.png";
import {
  normalizeCollectionImage,
  type CollectionImage,
  type NormalizedImage,
} from "@/utils/images";

interface Props {
  title?: string;
  heading?: string;
  description?: string;
  className?: string;
  ctaText?: string;
  ctaLink?: string;
  stats?: {
    rating?: string;
    customers?: string;
  };
  image?: CollectionImage;
  imageAlt?: string;
}

const {
  title,
  heading,
  description,
  className = "",
  ctaText = "View Our Pricing",
  ctaLink = "#pricing",
  stats = { rating: "5/5", customers: "64" },
  image,
  imageAlt,
} = Astro.props;

// Use title as subtitle (small text on top), heading as main title (large text)
const displaySubtitle = `Marketing for ${title}`;
const displayTitle = heading || `Marketing for ${title}`;

// Normalize the image
const fallbackAlt = imageAlt ?? `${title} marketing services`;
const normalizedImage: NormalizedImage | undefined = normalizeCollectionImage(
  image as CollectionImage,
  fallbackAlt,
);

const heroImage =
  normalizedImage ??
  ({
    type: "asset",
    src: placeholderImage,
    alt: fallbackAlt,
  } as NormalizedImage);

// Generate optimized responsive images for LCP optimization
// Above-the-fold quality settings (lower for faster load)
const qualitySettings = { mobile: 50, tablet: 55, desktop: 60 };

let responsiveImages = null;

if (heroImage.type === "asset") {
  try {
    const [mobile, tablet, desktop] = await Promise.all([
      getImage({
        src: heroImage.src,
        format: "webp",
        quality: qualitySettings.mobile,
        width: 640,
      }),
      getImage({
        src: heroImage.src,
        format: "webp",
        quality: qualitySettings.tablet,
        width: 1024,
      }),
      getImage({
        src: heroImage.src,
        format: "webp",
        quality: qualitySettings.desktop,
        width: 800,
      }),
    ]);
    responsiveImages = { mobile, tablet, desktop };
  } catch (error) {
    console.error('Failed to optimize hero image:', error);
  }
}
---

<section
  class={`min-h-[90vh] flex items-center w-full bg-gray-50 ${className}`}
>
  <div class="container mx-auto px-4 py-20 max-w-7xl">
    <div class="flex flex-col lg:flex-row items-start gap-12">
      <!-- Left Column - Text Content -->
      <div class="lg:w-1/2 flex flex-col items-start text-left gap-6 lg:sticky lg:top-0 min-h-screen lg:min-h-auto">
        <!-- Header with title on top, heading below -->
        <SectionHeader
          subtitle={displaySubtitle}
          title={displayTitle}
          titleTag="h1"
          subtitleClass="text-gray-400 font-semibold h6 m-0 p-0 uppercase tracking-wider"
          titleClass="h1 text-primary m-0"
          align="left"
        />

        <!-- Description -->
        {
          description && (
            <p class="text-gray-500 text-xl main-text leading-relaxed p-0 m-0">
              {description}
            </p>
          )
        }

        <!-- CTA Button -->
        <div class="pt-4">
          <Button href={ctaLink} variant="primary" size="lg">
            {ctaText}
          </Button>
        </div>

        <!-- Stats Section -->
        <!-- <HeroStats stats={stats} /> -->
      </div>

      <!-- Right Column - Image (Optimized for LCP) -->
      <div class="lg:w-1/2">
        <div class="relative overflow-hidden rounded-lg shadow-xl">
          {
            responsiveImages ? (
              <picture>
                <source
                  media="(max-width: 640px)"
                  srcset={responsiveImages.mobile.src}
                  type="image/webp"
                />
                <source
                  media="(min-width: 641px) and (max-width: 1024px)"
                  srcset={responsiveImages.tablet.src}
                  type="image/webp"
                />
                <source
                  media="(min-width: 1025px)"
                  srcset={responsiveImages.desktop.src}
                  type="image/webp"
                />
                <img
                  src={responsiveImages.desktop.src}
                  alt={heroImage.alt}
                  class="w-full h-auto object-cover"
                  loading="eager"
                  fetchpriority="high"
                  decoding="sync"
                />
              </picture>
            ) : (
              <img
                src={heroImage.type === "url" ? heroImage.src : ""}
                alt={heroImage.alt}
                class="w-full h-auto object-cover"
                loading="eager"
                fetchpriority="high"
              />
            )
          }
        </div>
      </div>
    </div>
  </div>
</section>
