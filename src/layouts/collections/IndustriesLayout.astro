---
// src/layouts/collections/IndustriesLayout.astro
/**
 * Industries Layout - Landing Page Style for Industries
 *
 * Features:
 * - IndustryHero with title on top, heading below (centered, CTA to pricing)
 * - Two-column layout: MDX content (left) + child industries sidebar (right)
 * - Services, Pricing, Testimonials, Portfolio sections below
 * - CTA section at bottom linking to pricing
 */
import BaseLayout from "@/layouts/BaseLayout.astro";
import type { CollectionLayoutProps } from "./types";
import IndustryHero from "../IndustryHero.astro";
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import CaseStudySection from "@/layouts/CaseStudySection.astro";
import { query, sortByDate, sortByOrder } from "@/utils/query";
import { children, roots } from "@/utils/query/snippets";
import Button from "@/components/Button/Button";
import SectionHeader from "@/components/SectionHeader";

// Case study images for Koi Roofing
import koiRoofingImage from "@/assets/koirandssite.png";
import koiJohns from "@/assets/koijohns1.jpg";
import koiTeam from "@/assets/koi_team2.JPG";

const {
  entry,
  collection,
  collectionMeta,
  Content,
  isIndexPage,
  seoProps = {},
  ...extraProps
} = Astro.props as CollectionLayoutProps;

const data = entry?.data || {};

// Check if this is a page that should show the Koi Roofing & Solar case study
const isRoofersPage = entry?.id === "roofers" || entry?.slug === "roofers";
const isSolarPage = entry?.id === "solar" || entry?.slug === "solar";
const showKoiCaseStudy = isRoofersPage || isSolarPage;
---

<BaseLayout {...seoProps}>
  <main class="flex-1">
    {/* Hero section - text left, image right */}
    <IndustryHero
      title={data.title}
      heading={data.heading}
      description={data.description}
      image={data.featuredImage}
    />

    {/* Services we offer for this industry - right after hero */}
    <ContentRenderer
      query={roots("services")}
      variant="ServicesVariant"
      columns={3}
      gap="lg"
    />

    {/* Landing page content section: MDX with AboutSection for unique industry content */}
    {Content && (
      <Content />
    )}

    {/* Process Steps Section */}
    <ContentRenderer
      query={query("steps").orderBy(sortByOrder())}
      variant="StepsVariant"
      title="Our Process"
      heading="How We Get You More Customers"
    />

    {/* Case Study - Show on Roofers and Solar pages */}
    {showKoiCaseStudy && (
      <CaseStudySection
        subtitle="Where We Learned"
        title="Built From Real Results With Koi Roofing & Solar"
        description={isRoofersPage
          ? "This is our trade. We built this marketing system to grow Koi Roofing and Solar from the ground up. The same strategies that filled their pipeline with qualified leads are now available to roofers like you."
          : "This is our trade. We built this marketing system to grow Koi Roofing and Solar from the ground up. The same strategies that filled their pipeline with qualified leads are now available to solar companies like you."
        }
        images={[
          { src: koiRoofingImage, alt: "Koi Roofing and Solar website" },
          { src: koiJohns, alt: "Koi Roofing and Solar team member" },
          { src: koiTeam, alt: "Koi Roofing and Solar team" },
        ]}
        stats={[
          { value: "300%", label: "Increase in Leads" },
          { value: "400%", label: "More Search Visibility" },
          { value: "2.5x", label: "Revenue Growth" },
          { value: "50+", label: "5-Star Reviews" },
        ]}
        ctaText="Get These Results For Your Business"
        ctaUrl="/contact"
      />
    )}

        {/* Pricing */}
    <ContentRenderer
      id="pricing"
      query={query("pricing").orderBy(sortByOrder())}
      variant="PricingVariant"
      columns={3}
      gap="lg"
    />

    {/* projects and testimonials must remain but stay commented out due to the lack of these and will be reenabled at a later point
    <ContentRenderer
      query={query("testimonials")}
      variant="TestimonialsVariant"
    />
    <ContentRenderer
      query={query("projects").orderBy(sortByDate("publishDate", "desc"))}
      variant="PortfolioBoxVariant"
    />
    */}

    {/* Other Industries We Serve */}
    <ContentRenderer
      query={query("industries").where((item) => item.id !== entry?.id).orderBy(sortByOrder())}
      variant="IndustriesGridVariant"
      title="Other Trades We Serve"
      heading="We Help All Home Service Contractors"
      description="Our marketing strategies work across the trades. See how we can help grow your business."
    />

    <!-- {FAQ Section} -->
     <ContentRenderer
      query={query("faq")}
      variant="AccordionVariant"
      />

    {/* CTA Section */}
    <section class="container mx-auto">
      <div class="container lg:my-20 py-10 lg:py-20 bg-MainDark text-white px-4 max-w-7xl">
        <div class="text-center flex flex-col gap-3">
          <SectionHeader
            subtitle="Let's Get Started"
            title="Ready To Grow Your Business?"
            titleTag="h2"
            subtitleClass="text-gray-400 h6 tracking-wider uppercase m-0"
            titleClass="h2 font-bold leading-tight m-0"
            align="center"
          />
          <p class="text-xl text-gray-300">See our transparent pricing and find the perfect plan for your business.</p>
          <div class="pt-6">
            <Button variant="secondary" href="#pricing">View Pricing</Button>
          </div>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>
