---
// src/layouts/collections/ServicesLayout.astro
/**
 * Services Layout - Default Item Page Layout
 *
 * The standard layout for individual services collection items.
 * Features:
 * - Uses MainHero with bannerImage (or default)
 * - Metadata display (date, author, reading time)
 * - MDX content rendering
 */
import BaseLayout from "@/layouts/BaseLayout.astro";
import SecondaryHero from "@/layouts/SecondaryHero.astro";
import type { CollectionLayoutProps } from "./types";
import MainHero from "../MainHero.astro";
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import { query, sortByDate } from "@/utils/query";
import { children, siblings } from "@/utils/query/snippets";
import { getItemKey } from "@/utils/collections";

const {
  entry,
  collection,
  collectionMeta,
  Content,
  isIndexPage,
  seoProps = {},
  ...extraProps
} = Astro.props as CollectionLayoutProps;

const data = entry?.data || {};
---

<BaseLayout {...seoProps}>
  <main class="flex-1">
    {/* Hero section - always displayed */}
    <MainHero title={data.title} description={data.description} />

    <!-- Services - children of the current or parent service -->
    <ContentRenderer
      query={children("services", entry.slug)}
      variant="ServicesVariant"
      columns={3}
      gap="lg"
    />

    <!-- Testimonials with rating filter -->
    <ContentRenderer
      query={query("testimonials")}
      variant="TestimonialsVariant"
    />

    <!-- Portfolio with sorting -->
    <ContentRenderer
      query={query("projects").orderBy(sortByDate("publishDate", "desc"))}
      variant="PortfolioVariant"
    />

    <!-- Services - auto-populates from services meta -->
    <ContentRenderer
      query={siblings("services", entry.slug)}
      variant="ServicesVariant"
      columns={3}
      gap="lg"
    />

    {/* MDX content */}
    {
      Content && (
        <article class="container mx-auto px-4">
          <div class="prose prose-lg max-w-4xl mx-auto">
            <Content />
          </div>
        </article>
      )
    }
  </main>
</BaseLayout>
