---
// src/components/AboutSection.astro
/**
 * About Section Component
 * Static layout with dynamic benefits from content collection
 */

import { Image } from "astro:assets";
import aboutImage from "@/assets/template-4.png";
import SectionHeader from "@/components/SectionHeader";
import Button from "@/components/Button/Button";
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import { query } from "@/utils/query";
import {
  normalizeCollectionImage,
  type CollectionImage,
  type NormalizedImage,
} from "@/utils/images";

const DEFAULT_ALT_TEXT = "Professional team member in office";

export interface Props {
  showButton?: boolean;
  subtitle: string;
  title: string;
  description: string;
  learnMoreUrl: string;
  image?: CollectionImage;
  imageAlt?: string;
}

const {
  showButton = true,
  subtitle,
  title,
  description,
  learnMoreUrl,
  image,
  imageAlt,
} = Astro.props;

const fallbackAlt = imageAlt ?? DEFAULT_ALT_TEXT;
const normalizedImage: NormalizedImage | undefined = normalizeCollectionImage(
  image as CollectionImage,
  fallbackAlt
);

const sectionImage =
  normalizedImage ??
  ({
    type: "asset",
    src: aboutImage,
    alt: fallbackAlt,
  } as NormalizedImage);
---

<section class="bg-MainDark text-MainLight py-20">
  <div class="container mx-auto px-4 max-w-7xl">
    <div class="flex flex-col items-start lg:flex-row gap-12">
      <!-- Left Column - Image -->
      <div class="relative lg:w-1/2 lg:sticky lg:top-0">
        <div class="relative overflow-hidden rounded-lg">
          {
            sectionImage.type === "asset" ? (
              <Image
                src={sectionImage.src}
                alt={imageAlt ?? sectionImage.alt}
                class="w-full h-auto object-cover rounded-lg"
                loading={"lazy"}
                fetchpriority={"low"}
              />
            ) : (
              <img
                src={sectionImage.src}
                alt={imageAlt ?? sectionImage.alt}
                class="w-full h-auto object-cover rounded-lg"
                loading="lazy"
              />
            )
          }
        </div>
      </div>

      <!-- Right Column - Content -->
      <div class="space-y-6 lg:w-1/2">
        <!-- Section Header -->
        <SectionHeader
          subtitle={subtitle}
          title={title}
          titleTag="h2"
          subtitleClass="text-gray-400 h6 tracking-wider"
          titleClass="h2 font-bold leading-tight"
        />

        <!-- Description -->
        <p class="text-main leading-relaxed">
          {description}
        </p>

        <!-- Learn More Button -->
        {
          showButton && (
            <div class="pt-4">
              <Button
                href={learnMoreUrl}
                variant="secondary"
                size="lg"
                aria-label={`Learn more about ${title}`}
              >
                Learn more 
              </Button>
            </div>
          )
        }
      </div>
    </div>
  </div>

  <!-- Bottom Section -->
  <div class="container mx-auto px-4 max-w-7xl mt-20">
    <slot />
  </div>
</section>
